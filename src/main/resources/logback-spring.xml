<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <!-- =============================================
         Development profile: coloured console output
         ============================================= -->
    <springProfile name="dev,local">
        <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
            <encoder>
                <pattern>%d{HH:mm:ss.SSS} %highlight(%-5level) [%cyan(%thread)] %yellow(%logger{36}) - %msg%n</pattern>
            </encoder>
        </appender>

        <root level="INFO">
            <appender-ref ref="CONSOLE" />
        </root>

        <logger name="com.nutritiontracker" level="DEBUG" additivity="false">
            <appender-ref ref="CONSOLE" />
        </logger>
    </springProfile>

    <!-- =============================================
         Production profile: structured JSON logging
         (compatible with Railway / AWS CloudWatch / Datadog)
         ============================================= -->
    <springProfile name="prod">
        <appender name="JSON_STDOUT" class="ch.qos.logback.core.ConsoleAppender">
            <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
                <!-- Minimal JSON-like pattern readable by most log aggregators.
                     For full JSON consider adding logstash-logback-encoder dependency. -->
                <pattern>{"time":"%d{yyyy-MM-dd'T'HH:mm:ss.SSSZ}","level":"%-5level","logger":"%logger{40}","thread":"%thread","message":"%replace(%msg){'\"','\\"'}","exception":"%replace(%ex{full}){'\"','\\"'}"}%n</pattern>
            </encoder>
        </appender>

        <root level="INFO">
            <appender-ref ref="JSON_STDOUT" />
        </root>

        <!-- Silence noisy libraries in production -->
        <logger name="org.springframework.web" level="WARN" />
        <logger name="org.hibernate" level="WARN" />
        <logger name="com.zaxxer.hikari" level="INFO" />
        <logger name="org.flywaydb" level="INFO" />

        <!-- Application logs at INFO in production -->
        <logger name="com.nutritiontracker" level="INFO" additivity="false">
            <appender-ref ref="JSON_STDOUT" />
        </logger>
    </springProfile>

    <!-- =============================================
         Test profile: minimal output to keep CI clean
         ============================================= -->
    <springProfile name="test">
        <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
            <encoder>
                <pattern>%-5level [%thread] %logger{30} - %msg%n</pattern>
            </encoder>
        </appender>

        <root level="WARN">
            <appender-ref ref="CONSOLE" />
        </root>

        <logger name="com.nutritiontracker" level="INFO" additivity="false">
            <appender-ref ref="CONSOLE" />
        </logger>
    </springProfile>

</configuration>
